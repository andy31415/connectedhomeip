{% macro render_field(field) -%}
{%- if field.qualities %}{{field.qualities | idltxt}} {% endif -%}
{{field.data_type.name}} {{field.name}}
{%- if field.is_list %}[]{% endif -%}
{##} = {{field.code}};
{%- endmacro %}
// This IDL was auto-generated from a parsed data structure

{%  for cluster in idl.clusters -%}
{{cluster.side | idltxt}} cluster {{cluster.name}} = {{cluster.code}} {
  {%- for enum in cluster.enums %}

  enum {{enum.name}} : {{ enum.base_type}} {
    {%- for entry in enum.entries %}
    {{entry.name}} = {{entry.code}};
    {%- endfor %}
  }
  {%- endfor %}
  {%- for bitmap in cluster.bitmaps %}

  bitmap {{bitmap.name}} : {{ bitmap.base_type}} {
    {%- for entry in bitmap.entries %}
    {{entry.name}} = {{entry.code}};
    {%- endfor %}
  }
  {%- endfor %}
  {%- for s in cluster.structs %}

  {% if s.tag %}{{s.tag | idltxt}} {% endif -%}
  {% if s.qualities %}{{s.qualities | idltxt}} {% endif -%}
  struct {{s.name}} {##}
  {%- if s.code %}= {{s.code}} {% endif -%}
  {
    {%- for field in s.fields %}
    {{render_field(field)}}
    {%- endfor %}
  }
  {%- endfor %}
  {%- for e in cluster.events %}

  {% if e.qualities %}{{e.qualities | idltxt}} {% endif -%}
  {{e.priority | idltxt}} event {{e | event_access}}{{e.name}} = {{e.code}} {
    {%- for field in e.fields %}
    {{render_field(field)}}
    {%- endfor %}
  }
  {%- endfor %}


  // FIXME:
  //  - events
  //  - attributes
  //  - commands
}

{% endfor %}

{%- if idl.endpoints %}
{% for endpoint in idl.endpoints %}

endpoint {{endpoint.number}} {
  // FIXME: report endpoint
}
{%  endfor %}
{%  endif %}
